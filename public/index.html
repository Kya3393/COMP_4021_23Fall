<!DOCTYPE html>
<html>
<head>
    <title>Shoot Guns!</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="style.css" rel="stylesheet"> 
    <link rel="shortcut icon" href="#">
</head>
<body>
    <div id="game-container">
        <canvas width="1000px" height="1000px"></canvas>
        <div id="main-panel" class="row">
            <div id="title">PIXEL WARFARE</div>
            <svg xmlns="http://www.w3.org/2000/svg" id="game-start">
                <defs>
                    <linearGradient id="title-fill" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0.2" stop-color="red" />
                        <stop offset="0.4" stop-color="yellow" />
                        <stop offset="0.6" stop-color="green" />
                        <stop offset="0.8" stop-color="purple" />
                    </linearGradient>
                </defs>
                <text id="game-title" x="50%" y="45%">Pixel Warfare</text>
                <text x="50%" y="60%">Click here to start the game</text>
            </svg>
            <div id="menu-overlay" class="overlay row" >
                <div id="front-page" class="content shadow row">
                    <form id="signin-form" class="col">
                        <div class="caption">SIGN IN</div>
                        <div class="spacer-0"></div>
                        <input id="signin-username" placeholder="Enter your username" autocomplete="off"></input>
                        <input id="signin-password" type="password" placeholder="Enter your password"></input>
                        <div class="spacer-0"></div>
                        <button type="submit">Sign In</button>
                        <div id="signin-message" class="warning center"></div>
                        <div class="spacer-grow"></div>
                    </form>
        
                    <div class="spacer-0"></div>
        
                    <form id="register-form" class="col">
                        <div class="caption">REGISTER TO CREATE NEW ACCOUNT</div>
                        <div class="spacer-0"></div>
                        <input id="register-username" maxlength="10" placeholder="Enter your username" autocomplete="off"></input>
                        <input id="register-name" maxlength="16" placeholder="Enter your name" autocomplete="off"></input>
                        <input id="register-password" type="password" placeholder="Enter your password" autocomplete="off"></input>
                        <input id="register-confirm" type="password" placeholder="Enter your password again" autocomplete="off"></input>
                        <div class="spacer-0"></div>
                        <button type="submit">Register</button>
                        <div id="register-message" class="warning center"></div>
                    </form>
                </div>
                <div id="game-menu" class="row" >
                    <div id="main-menu-panel">
                        <div id="menu-header" class="row">
                            <div id="menu-title">Game Room List
                            </div>
                
                            <div class="spacer-grow"></div>
                
                            <div id="user-panel" class="row">
                                <div class="field-content row shadow">
                                    <span class="user-name">-</span>
                                </div>
                                <button id="signout-button" class="icon"><span class="material-icons">logout</span></button>
                            </div>
                        </div>
                        <div id="room-list-panel" class="col"></div>
                        <button id="new-room" class="icon">
                            New Room
                        </button>
                    </div>
                    <div id="create-room-panel">
                        <div id="menu-header" class="row">
                            <div id="menu-title">Create Room
                            </div>
                
                            <div class="spacer-grow"></div>
                
                            <button id="exit-create-room-button" class="icon"><span class="material-icons">exit_to_app</span></button>
                        </div>
                        <form id="create-room-form" class="col">
                            <input id="create-room-name" placeholder="Enter room name" autocomplete="off"></input>
                            <div class="spacer-0"></div>
                            <button type="submit">Create</button>
                            <div id="create-form-message" class="warning center"></div>
                            <div class="spacer-grow"></div>
                        </form>

                    </div>
                    <div id="room-panel">
                        <div id="menu-header" class="row">
                            <div id="room-title">
                            </div>
                
                            <div class="spacer-grow"></div>
                
                            <button id="exit-room-button" class="icon"><span class="material-icons">exit_to_app</span></button>
                        </div>
                        <div id="room-user-list" class="col">
                        </div>
                        <button id="ready-check">Ready</button>
                    </div>
                    
                </div>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" id="game-over" style="display: none">
                <defs>
                    <linearGradient id="game-over-fill" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0" stop-color="red" />
                        <stop offset="0.5" stop-color="yellow" />
                        <stop offset="1" stop-color="red" />
                    </linearGradient>
                </defs>
                <text x="50%" y="50%">
                    Time's up! You have killed
                    <tspan id="final-gems">0</tspan>
                    enemy(ies).
                </text>
            </svg>
        </div>
    </div>

    <script src="/socket.io/socket.io.min.js"></script>
    <script src="scripts/client-server/authentication.js"></script>
    <script src="scripts/client-server/registration.js"></script>
    <script src="scripts/client-server/ui.js"></script>
    <script src="scripts/client-server/socket.js"></script>
    <script src="scripts/player_property/bounding_box.js"></script>
    <script src="scripts/player_property/player.js"></script>
    <script src="scripts/player_property/sprite.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script>
    $(document).ready(function() {

        UI.initialize();

        Authentication.validate(
            () => {
                console.log("signed in")
                
                UI.gameMenu()

                Socket.connect();
            },
            () => { 
                UI.startingScreen()
            }
        );

        /* Get the canvas and 2D context */
        const cv = $("canvas").get(0);
        const ctx = cv.getContext("2d");

        //Create the sounds

        const sounds = {
            pistol: new Audio("Assets/sfx/pistol_shot.mp3")
        }

        /* 
        const sounds = {
            background: new Audio("background.mp3"),
            collect: new Audio("collect.mp3"),
            gameover: new Audio("gameover.mp3")
        };*/
        $("#menu-overlay").on("click", function(){
            sounds.pistol.currentTime = 0.1
            sounds.pistol.play()
        })


        const totalGameTime = 60*3;   // Total game time in seconds
        let gameStartTime = 0;      // The timestamp when the game starts
        let killCounts = 0;      // The number of gems collected in the game

        /* Create the game area */
        const gameArea = BoundingBox(ctx, 50, 50, 950, 950);

        /* Create the sprites in the game */
        const player = Player(ctx, 500, 500, gameArea); // The player

		
        /* The main processing of the game */
        function doFrame(now) {
            if (gameStartTime == 0) gameStartTime = now;
			
            /* Update the time remaining */
            const gameTimeSoFar = now - gameStartTime;
            const timeRemaining = Math.ceil((totalGameTime * 1000 - gameTimeSoFar) / 1000);
            $("#time-remaining").text(timeRemaining);

            /* TODO */
            /* Handle the game over situation here */
            /*if(timeRemaining <= 0){
                $("#final-gems").text(collectedGems.toString());
                $("#game-over").show();
                sounds.gameover.play();
                return;
            }*/

            /* Update the sprites */
            player.update(now);

            /* TODO */
            /* Randomize the gem and collect the gem here */
			/*
            let gem_pos = gem.getXY();
            if(gem.getAge(now) >= gemMaxAge){
                gem.randomize(gameArea);
            }
            //if( (player.getBoundingBox()).intersect(gem.getBoundingBox())){
            if( (player.getBoundingBox()).isPointInBox(gem_pos.x, gem_pos.y)){    
                collectedGems++;
                sounds.collect.currentTime = 0;
                sounds.collect.play();
                gem.randomize(gameArea);
            }
			*/


            /* Clear the screen */
            ctx.clearRect(0, 0, cv.width, cv.height);

            /* Draw the sprites */
            player.draw();

            requestAnimationFrame(doFrame);
        }

        

        /* Handle the start of the game */
        // $("#game-start").on("click", function() {

        //     /* Hide the start screen */
        //     $("#game-start").hide();

        //     // show sign-in panel

			
		// 	/////////////////////////////////
        //     // 3. Load the crosshair image

        //     // 4. Add mouse event listeners to track the cursor position
        //     // cv.addEventListener("mousemove", function(event) {
        //     //     const rect = cv.getBoundingClientRect();
        //     //     const mouseX = event.clientX - rect.left;
        //     //     const mouseY = event.clientY - rect.top;

        //     //     // 5. Clear the canvas
        //     //     ctx.clearRect(0, 0, cv.width, cv.height);

        //     //     // 6. Draw the crosshair image at the cursor position
        //     //     ctx.drawImage(crosshairImg, mouseX - crosshairImg.width / 2, mouseY - crosshairImg.height / 2);
        //     // });

        //     // // Create an image element for the character parts
        //     // const characterImage = new Image();
        //     // // // Set the source of the image element
        //     // characterImage.src = "Assets/TopDown/Assm.png";

        //     // // Wait for the image to load
        //     // characterImage.onload = function() {
        //     //     // Draw the character parts on the canvas 6x6 2724*3212
        //     //     s_x = 0;
        //     //     s_y = 0;
        //     //     s_width = 2724/6;
        //     //     s_height = 3212/6;
        //     //     d_x = 300;
        //     //     d_y = 300;
        //     //     d_width = (2724/6)*0.3;
        //     //     d_height = (3212/6)*0.3;
        //     //     ctx.drawImage(characterImage, s_x, s_y, s_width, s_height, d_x, d_y, d_width, d_height); // Draw the hand
        //     //     //ctx.drawImage(characterImage, 50, 0, 100, 150, 0, 0, 100, 150); // Draw the body
        //     //     //ctx.drawImage(characterImage, 150, 0, 50, 50, 0, 0, 50, 50); // Draw the backpack
        //     // }

        //     // Sign in
        //     UI.initialize();
    
        //     // Validate the signin
        //     Authentication.validate(
        //         () => {
        //             SignInForm.hide();
        //             UserPanel.update(Authentication.getUser());
        //             UserPanel.show();
    
        //             Socket.connect();
        //         },
        //         () => { 
        //             SignInForm.show();
        //             startingScreen.show() }
        //     );
                
		// 	/* Handle the keydown of arrow keys and spacebar */
        //     $(document).on("keydown", function(event) {

        //         /* Handle the key down */
        //         // W key
        //         if (event.keyCode === 87) {
        //             player.move(2); // Move up
        //         }
        //         // S key
        //         if (event.keyCode === 83) {
        //             player.move(4); // Move down
        //         }
        //         // A key
        //         if (event.keyCode === 65) {
        //             player.move(1); // Move left
        //         }
        //         // D key
        //         if (event.keyCode === 68) {
        //             player.move(3); // Move right
        //         }

        //         // spacebar key ( cheat )
        //         if(event.keyCode == 32){
        //             player.speedUp();
        //         }

        //     });

        //     /* Handle the keyup of arrow keys and spacebar */
        //     $(document).on("keyup", function(event) {


        //         /* TODO */
        //         /* Handle the key up */
        //         // W key
        //         if (event.keyCode === 87) {
        //             player.stop(2); // Move up
        //         }
        //         // S key
        //         if (event.keyCode === 83) {
        //             player.stop(4); // Move down
        //         }
        //         // A key
        //         if (event.keyCode === 65) {
        //             player.stop(1); // Move left
        //         }
        //         // D key
        //         if (event.keyCode === 68) {
        //             player.stop(3); // Move right
        //         }

        //         // spacebar key ( cheat )
        //         if(event.keyCode == 32){
        //             player.slowDown();
        //         }

        //     });

        //     /* Start the game */
        //     requestAnimationFrame(doFrame);
            
            
            
        // });
    });
    </script>
</body>
</html>
